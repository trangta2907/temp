<div class="container">
    <div class="" style="height: 100px;"></div>
    <!--alert-->
    <div ng-include="'/views/common/Alert.html'"></div>
    <!--end alert-->
    <h4 style="text-align: center; ">Tài khoản</h4>
    <header>
        <ul class="nav nav-tabs row" id="myTab" role="tablist">
            <li class="nav-item col-3" role="presentation">
                <div class="nav-link active" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button"
                    role="tab" aria-controls="user" aria-selected="true" style="color: black;">
                    <i class="fas fa-user"></i> 
                    {{personal.fullname}}
                </div>
            </li>
            <li class="nav-item col-3" role="presentation">
                <div class="nav-link" id="ordered-tab" data-bs-toggle="tab" data-bs-target="#ordered" type="button"
                    role="tab" aria-controls="ordered" aria-selected="false" style="color: black;">
                    <i class="fas fa-book"></i>
                    Đơn hàng của tôi
                </div>
            </li>
        </ul>
        <div class="mt-3"></div>
    </header>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="user" role="tabpanel" aria-labelledby="user-tab">
            <h5 style="text-align: center;">Thông tin cá nhân</h5>
            <form class="mt-3 mb-3">
                <div class="mt-2 row">
                    <div class="col-2 row"></div>
                    <div class="col-8 row">
                        <div class="row mt-3">
                            <label class="col-3" for="fullname">
                                Họ và tên
                            </label>
                            <div class="col-9">
                                <input type="text" name="fullname" id="fullname" class="form-control"
                                ng-model="personal.fullname">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="username">
                                Tên đăng nhập
                            </label>
                            <div class="col-9">
                                <input type="text" name="username" id="username" class="form-control"
                                ng-model="personal.username" readonly>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="email">
                                Email
                            </label>
                            <div class="col-9">
                                <input type="text" name="email" id="email" class="form-control" ng-model="personal.email">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="phone">
                                Số điện thoại
                            </label>
                            <div class="col-9">
                                <input type="text" name="phone" id="phone" class="form-control" ng-model="personal.phone">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="province">
                                Tỉnh - Thành phố
                            </label>
                            <div class="col-9">
                                <input class="form-control dropdown-toggle" type="text" id="personalProvince"
                                    ng-model="personal.province" ng-focus="showProvince()"
                                    placeholder="Tỉnh, thành phố.." data-bs-toggle="dropdown"
                                    aria-expanded="false" readonly style="background-color: rgb(255, 255, 255);"/>
                                <div class="dropdown-menu" aria-labelledby="personalProvince"
                                    style="width: 588px; height: 200px; overflow-y: scroll">
                                    <p id="province" ng-repeat="province in listProvince"
                                        ng-click="chooseProvincePersonal($index)">
                                        <a href=""
                                            style="text-decoration: none; color: black;">{{province.ProvinceName}}</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="district">
                                Quận - Huyện
                            </label>
                            <div class="col-9">
                                <input class="form-control dropdown-toggle" type="text" id="personalDistrict"
                                    ng-model="personal.district" ng-focus="showDistrict()" placeholder="Quận/Huyện..."
                                    data-bs-toggle="dropdown" aria-expanded="false" readonly style="background-color: rgb(255, 255, 255);"/>
                                <div ng-show="personal.province" class="dropdown-menu"
                                    aria-labelledby="personalDistrict"
                                    style="width: 588px; height: 200px; overflow-y: scroll">
                                    <p id="district" ng-repeat="district in listDistrict"
                                        ng-click="chooseDistrictPersonal($index)">
                                        <a href=""
                                            style="text-decoration: none; color: black;">{{district.DistrictName}}</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="ward">
                                Phường - Xã
                            </label>
                            <div class="col-9">
                                <input class="form-control dropdown-toggle" type="text" id="personalWard"
                                    ng-model="personal.ward" ng-focus="showWard()" placeholder="Phường, xã..."
                                    data-bs-toggle="dropdown" aria-expanded="false" readonly style="background-color: rgb(255, 255, 255);"/>
                                <div ng-show="personal.district" class="dropdown-menu"
                                    aria-labelledby="personalWard"
                                    style="width: 588px; height: 200px; overflow-y: scroll">
                                    <p id="ward" ng-repeat="ward in listWard"
                                        ng-click="chooseWardPersonal($index)">
                                        <a href=""
                                            style="text-decoration: none; color: black;">{{ward.WardName}}</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <label class="col-3" for="address">
                                Địa chỉ chi tiết
                            </label>
                            <div class="col-9">
                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" ng-model="personal.address"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-1 row"></div>
                    <div class="d-flex justify-content-center mt-3">
                        <button type="button" class="btn btn-outline-info me-2" ng-click="updatePersonal()">Cập nhập</button>
                        <button type="button" class="btn btn-outline-danger" ng-click="cancelUpdatePersonal()">Hủy</button>

                    </div>

                </div>
            </form>
        </div>
        <div class="tab-pane fade" id="ordered" role="tabpanel" aria-labelledby="ordered-tab">
            <h5 style="text-align: center;">Đơn hàng của tôi</h5>

            <div class="row mt-">
                <div class="col-sm-12 col-md-12 mt-3">
                    <div class="row mt-3">
                        <div class="mb-3">
                            <div class="card">
                                <div class="card-body mt-3">
                                    <div class="table-responsive">
                                        <table id="example" class="table data-table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Mã đơn hàng</th>
                                                    <th>Mã vận đơn GHN</th>
                                                    <th>Ngày mua</th>
                                                    <th>Ngày nhận</th>
                                                    <th>Địa chỉ</th>
                                                    <th>Tổng tiền</th>
                                                    <!-- <th>Phương thức thanh toán</th> -->
                                                    <th>Trạng thái</th>
                                                    <th>Thao tác</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="order in orders">
                                                    <td>{{order.code}}</td>
                                                    <td>{{order.codeGHN}}</td>
                                                    <td>
                                                        {{order.createdDate | date:"dd/MM/yyyy ' - ' h:mma"}}
                                                    </td>
                                                    <td ng-if="order.status != 'DELIVERED' "></td>
                                                    <td ng-if="order.status == 'DELIVERED' ">
                                                        {{order.updateDate | date:"dd/MM/yyyy ' - ' h:mma"}}
                                                    </td>
                                                    <td>
                                                        {{order.address}}
                                                        {{order.ward}}, {{order.district}}, {{order.province}}
                                                    </td>
                                                    <td>
                                                        {{order.totalMoney | currency : "" : 0}}
                                                    </td>
                                                    <!-- <td>{{order.paymentType == "VNPAY" ? "VNPay" : "Khi nhận hàng"}}</td> -->
                                                    <td>
                                                        {{order.status == "WAIT_FOR_CONFIRMATION" ? "Đang chờ xác nhận" : order.status == "CONFIRMED" ? "Đang xử lý" : 
                                                            order.status == "UNCONFIRM" ? "Không được xác nhận" : order.status == "DELIVERING" ? "Đang giao hàng": 
                                                            order.status == "NO_DELIVERY" ? "Không giao được hàng" : order.status == "DELIVERED" ? "Đã giao hàng" : 
                                                            order.status == "CANCELLED" ? "Đã hủy" : "Đang xử lý" }}
                                                    </td>
                                                    <td>
                                                        <div class="row d-flex">
                                                            <div class="col-1 pt-1">
                                                                <h4>
                                                                    <a href="#" style="color: rgb(8, 159, 41);" 
                                                                    data-bs-toggle="modal" data-bs-target="#detailModal{{$index}}">
                                                                        <i class="bi bi-eye"></i>
                                                                    </a>
                                                                </h4>
                                                            </div>  
                                                            <div class="col-1 pt-1 ms-1 me-1" ng-show="order.status == 'WAIT_FOR_CONFIRMATION' ">
                                                                <h5>
                                                                    <a href="#" class="ps-2" style="color: rgb(234, 55, 55);"
                                                                        data-bs-toggle="modal" data-bs-target="#cancel{{$index}}">
                                                                        <i class="bi bi-x-circle"></i>
                                                                    </a>
                                                                    <div class="modal fade" id="cancel{{$index}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                        <div class="modal-dialog modal-dialog-centered">
                                                                            <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                                 </div>
                                                                                <div class="modal-body">
                                                                                    Hủy đơn hàng này
                                                                                </div>
                                                                                <div class="modal-footer">
                                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                                                                    <button type="button" data-bs-dismiss="modal" class="btn btn-danger" ng-click="deleteOrder(order, $index)">Xóa</button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </h5>
                                                            </div>          
                                                            <div ng-if="order.showEdit" class="col-1 pt-1 ms-2">
                                                                <h4>
                                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#update{{$index}}" style="color: rgb(198, 198, 18);">
                                                                        <i class="bi bi-pencil-square"></i>
                                                                    </a>
                                                                </h4>
                                                            </div>
                                                            <div class="col-auto ms-2">
                                                                <button class="btn btn-info btn-sm" ng-if="order.status == 'DELIVERED' && order.isReturn " ng-click="returnOrder(order, $index)">Đổi trả</button>
                                                            </div>
                                                        </div>
        
                                                        <!-- Modal view detail -->
                                                        <div class="modal fade" id="detailModal{{$index}}" tabindex="-1"
                                                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog modal-xl">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel">
                                                                            Chi tiết đơn hàng: {{order.code}}
                                                                        </h5>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <!--table-->
                                                                    <div class="modal-body">
                                                                        <div class="row">
                                                                            <div class="col-9">
                                                                                Mã đơn hàng: <b> {{order.code}} </b> - Ngày tạo: <b>{{order.createdDate | date:"dd/MM/yyyy ' - ' h:mma"}}</b> <br>
                                                                                Tên khách hàng: <b>{{order.customerName}} - SĐT: {{order.phone}}</b> <br>
                                                                                Địa chỉ: <b>{{order.address}}, {{order.ward}}, {{order.district}}, {{order.province}}</b> <br>
                                                                                Phương thức thanh toán: <b>{{order.paymentType == "VNPAY" ? "VNPay" : "Khi nhận hàng"}}</b>
                                                                            </div>
                                                                        </div>
                                                                        <table class="mt-4 table">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>STT</th>
                                                                                    <th>Sản phẩm</th>
                                                                                    <th>Size</th>
                                                                                    <th>Màu sắc</th>
                                                                                    <th>Giá tiền</th>
                                                                                    <th>Số lượng</th>
                                                                                    <th>Tổng tiền</th>
                                                                                    <!-- <th>Thao tác</th> -->
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr ng-repeat="orderDetail in order.orderDetails">
                                                                                    <td>{{$index + 1}}</td>
                                                                                    <td>
                                                                                        {{orderDetail.product.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.productDetail.size.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.productDetail.color.name}}
        
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.price | currency: "" : 0}}
        
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.quantity}}
        
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.price * orderDetail.quantity | currency : "" :0}}
                                                                                    </td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                    <hr>
                                                                    <div ng-if="order.orderHistories"> 
                                                                        <h5>Lịch sử đổi trả</h5>
                                                                        <table class="table table-responsive">  
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>STT</th>
                                                                                    <th>Sản phẩm</th>
                                                                                    <th>Size</th>
                                                                                    <th>Màu sắc</th>
                                                                                    <th>Số lượng</th>
                                                                                    <th>Hành động</th>
                                                                                    <th>Trạng thái</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr ng-repeat="orderHistory in order.orderHistories">
                                                                                    <td>{{$index + 1}}</td>
                                                                                    <td>
                                                                                        {{orderHistory.orderDetail.product.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderHistory.productDetail.size.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderHistory.productDetail.color.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderHistory.quantity}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderHistory.action == "DOI" ? "Đổi" : "Trả"}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderHistory.status == "DONE" ? "Hoàn thành" : "Không được xác nhận"}}
                                                                                    </td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
        
                                                        <!-- modal update -->
                                                        <div class="modal fade" id="update{{$index}}" tabindex="-1"
                                                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog modal-xl">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel">
                                                                            Chi tiết đơn hàng: {{order.code}}
                                                                        </h5>
                                                                        <button type="button" class="btn-close"
                                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <!--table model-->
                                                                    <div class="modal-body row">
                                                                        <div class="">
                                                                            Mã đơn hàng: <b> {{order.code}} </b> - Ngày tạo: <b>{{order.createdDate | date:"dd/MM/yyyy ' - ' h:mma" }}</b> <br>
                                                                            Tên khách hàng: <b>{{order.customerName}} - SĐT: {{order.phone}}</b> <br>
                                                                            <div class="row mt-2">
                                                                                <div class="col-1">
                                                        
                                                                                </div>
                                                                                <div class="col-11 ">
                                                                                    <div class="row">
                                                                                        <div class="col-6">
                                                                                            <input type="text" class="form-control" ng-model="order.customerName" id="fullname" placeholder="Họ và tên">
                                                                                        </div>
                                                                                        <div class="col-6">
                                                                                            <input type="text" class="form-control" ng-model="order.phone" id="phone" placeholder="Số điện thoại">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row mt-2">
                                                                                <div class="col-1">
                                                                                    <label for=""><h2><i class="bi bi-geo-alt"></i></h2></label>
                                                                                </div>
                                                                                <div class="col-11">
                                                                                    <div class="row">
                                                                                        <div class="col-6">
                                                                                            <input class="form-control dropdown-toggle" type="text" id="orderProvince{{$index}}" ng-model="order.province" 
                                                                                                ng-focus="showProvince()" placeholder="Tỉnh, thành phố.."  data-bs-toggle="dropdown" aria-expanded="false" />
                                                                                            <div class="dropdown-menu" aria-labelledby="orderProvince{{$index}}" style="width: 494px; height: 200px; overflow-y: scroll">
                                                                                                <p id="province" ng-repeat="province in listProvince" ng-click="chooseProvince(province.ProvinceID, $parent.$index)">
                                                                                                    <a  href="" style="text-decoration: none; color: black;">{{province.ProvinceName}}</a>
                                                                                                </p>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="col-6">
                                                                                            <input class="form-control dropdown-toggle" type="text" id="orderDistrict{{$index}}" ng-model="order.district" 
                                                                                                ng-focus="showDistrict()" placeholder="Quận/Huyện..."  data-bs-toggle="dropdown" aria-expanded="false"/>
                                                                                            <div ng-show="order.province" class="dropdown-menu" aria-labelledby="orderDistrict{{$index}}" style="width: 494px; height: 200px; overflow-y: scroll">
                                                                                                <p id="district" ng-repeat="district in listDistrict" ng-click="chooseDistrict(district.DistrictID, $parent.$index)">
                                                                                                    <a href="" style="text-decoration: none; color: black;">{{district.DistrictName}}</a>
                                                                                                </p>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="row mt-2">
                                                                                        <div class="col-6">
                                                                                            <input class="form-control dropdown-toggle" type="text" id="orderWard{{$index}}" ng-model="order.ward" 
                                                                                                ng-focus="showWard()" placeholder="Phường, xã..."  data-bs-toggle="dropdown" aria-expanded="false"/>
                                                                                            <div ng-show="order.district" class="dropdown-menu" aria-labelledby="orderWard{{$index}}" style="width: 494px; height: 200px; overflow-y: scroll">
                                                                                                <p id="ward" ng-repeat="ward in listWard" ng-click="chooseWard(ward.WardCode, $parent.$index)">
                                                                                                    <a  href="" style="text-decoration: none; color: black;">{{ward.WardName}}</a>
                                                                                                </p>
                                                                                            </div>  
                                                                                        </div>
                                                                                        <div class="col-6">
                                                                                            <input type="text" class="form-control" ng-model="order.address" placeholder="Địa chỉ chi tiết">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <div class="d-flex justify-content-end mt-4 mb-1">
                                                                            <div class="col-4">
                                                                                <input type="text" ng-model="nameProduct" id="productOrder" ng-focus="showAllProduct()" data-bs-toggle="dropdown" aria-expanded="false"
                                                                                    ng-keyup="searchProduct()" class="form-control" placeholder="Tên sản phẩm...">
            
                                                                                <div class="dropdown-menu" aria-labelledby="productOrder" style="width: 369px; height: 200px; overflow-y: scroll">
                                                                                    <div ng-show="products" ng-repeat="product in products" >
                                                                                        <div id="productDetail" ng-repeat="productDetail in product.productDetails" >
                                                                                            <p ng-click="chooseProduct(product, productDetail, $parent.$parent.$index)">
                                                                                                <a href="" style="text-decoration: none; color: black;"> 
                                                                                                    {{product.name}} - {{product.price | currency : "" : 0}}
                                                                                                </a><br>
                                                                                                <a href="" style="text-decoration: none; color: black;">
                                                                                                    Size{{productDetail.size.name}} - Màu: {{productDetail.color.name}} - Độ cao đế: {{productDetail.height.height}}cm - Chất liệu: {{productDetail.material.name}}
                                                                                                </a>
                                                                                            </p>
                                                                                            <hr>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
            
                                                                            </div>
                                                                        </div>
                                                                        <table class="mt-4 table">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>STT</th>
                                                                                    <th>Sản phẩm</th>
                                                                                    <th>Size</th>
                                                                                    <th>Màu sắc</th>
                                                                                    <th>Giá tiền</th>
                                                                                    <th>Số lượng</th>
                                                                                    <th>Tổng tiền</th>
                                                                                    <th></th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr ng-repeat="orderDetail in order.orderDetails">
                                                                                    <td>{{$index + 1}}</td>
                                                                                    <td>
                                                                                        {{orderDetail.product.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.productDetail.size.name}}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.productDetail.color.name}}
        
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.price | currency : "" : 0}}
        
                                                                                    </td>
                                                                                    <td>
                                                                                        <div class="d-flex justify-content-center align-center">
                                                                                            <input type="number" ng-change="changeQuantity($parent.$index)" min="1" class="col-2" ng-model="orderDetail.quantity">
                                                                                        </div>
                                                                                    </td>
                                                                                    <td>
                                                                                        {{orderDetail.price * orderDetail.quantity | currency : '' : 0}}
                                                                                    </td>
                                                                                    <td>
                                                                                        <div class="row">
                                                                                            <h5 class="col-auto mt-2">
                                                                                                <a type="button" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#deleteProduct{{$parent.$index}}" ng-click="chooseDelete($index, $parent.$index)" class="ps-2" style="color: rgb(234, 55, 55);">
                                                                                                    <i class="bi bi-trash"></i>
                                                                                                </a>
                                                                                            </h5>
                                                                                        </div>
                                                                                    </td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                        <div >
                                                                            <div class="d-flex justify-content-end">
                                                                                <h5>Tổng tiền đơn hàng: <b>{{ order.totalMoney | currency : "" : 0 }}</b></h5>
                                                                            </div>
                                                                            <div ng-if="order.voucher" class="d-flex justify-content-end">
                                                                                <small>Đã sử dụng voucher {{order.voucher.code}}, giá trị: {{order.voucher.promotion | currency : "" : 0}}</small>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#updateProduct{{$index}}">Cập nhật</button>
                                                                    </div>
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Modal xác nhận update product -->
                                                        <div class="modal fade" id="updateProduct{{$index}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        Thay đổi đơn hàng
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#update{{$index}}">Hủy</button>
                                                                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" ng-click="updateOrder($index)">Thay đổi</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!-- Modal xác nhận xóa sản phẩm khỏi đơn hàng -->
                                                        <div class="modal fade" id="deleteProduct{{$index}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-bs-target="#update{{$index}}"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div ng-if="!productLast">
                                                                            Xóa sản phẩm này, hành động này không thể hoàn tác ? 
                                                                        </div>
                                                                        <div ng-if="productLast">
                                                                            Đây là sản phẩm cuối cùng, nếu xóa đơn hàng của bạn sẽ bị hủy !!!
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#update{{$index}}">Hủy</button>
                                                                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-dismiss="modal" ng-click="deleteProduct()" data-bs-target="#update{{$index}}">Xóa</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <!-- modal show doi tra hang -->
                                        <div class="modal fade" id="modalReturnOrder" aria-hidden="true" aria-labelledby="modalReturnOrderLabel" tabindex="-1">
                                            <div class="modal-dialog modal-xl">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" ng-click="cancel()"></button>
                                                    </div>
                                                    <!--table model-->
                                                    <div class="modal-body row">
                                                        <div>
                                                            Mã đơn hàng: <b> {{orderReturn.code}} </b> - Ngày tạo: <b>{{orderReturn.createdDate | date:"dd/MM/yyyy ' - ' h:mma" }}</b> <br>
                                                            Tên khách hàng: <b>{{orderReturn.customerName}} - SĐT: {{orderReturn.phone}}</b> <br>
                                                            Địa chỉ: <b>{{orderReturn.address}}, {{orderReturn.ward}}, {{orderReturn.district}}, {{orderReturn.province}}</b> <br>
                                                        </div>
                                                        <div class="col-7 mt-4">
                                                            <div class="d-flex justify-content-center">
                                                                <p>Các sản phẩm</p>
                                                            </div>
                                                            <table class="table table-responsive">
                                                                <thead>
                                                                    <tr>
                                                                        <th>STT</th>
                                                                        <th>Sản phẩm</th>
                                                                        <th>Size</th>
                                                                        <th>Màu sắc</th>
                                                                        <th>Giá tiền</th>
                                                                        <th>Số lượng</th>
                                                                        <th ng-show="!active">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr ng-repeat="orderDetail in orderReturn.orderDetails">
                                                                        <td>{{$index + 1}}</td>
                                                                        <td>
                                                                            {{orderDetail.product.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderDetail.productDetail.size.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderDetail.productDetail.color.name}}
                                        
                                                                        </td>
                                                                        <td>
                                                                            {{orderDetail.price}}
                                        
                                                                        </td>
                                                                        <td>
                                                                            {{orderDetail.quantity}}
                                        
                                                                        </td>
                                                                        <td ng-show="!active">
                                                                            <div class="d-flex justify-content-between">
                                                                                <a href="" ng-click="changeProductReturn($index)" data-bs-toggle="modal" data-bs-target="#changeProduct" data-bs-dismiss="modal">Đổi</a>
                                                                                <div></div>
                                                                                <a href="" ng-click="returnProductReturn($index)" data-bs-toggle="modal" data-bs-target="#returnProduct" data-bs-dismiss="modal">Trả</a>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="col-5 mt-4 border-start">
                                                            <div class="d-flex justify-content-center">
                                                                <p>Xem lại</p>
                                                            </div>
                                                            <table class="table table-responsive">
                                                                <thead>
                                                                    <tr>
                                                                        <th>STT</th>
                                                                        <th>Sản phẩm</th>
                                                                        <th>Size</th>
                                                                        <th>Màu sắc</th>
                                                                        <th>Số lượng</th>
                                                                        <th>&nbsp;</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr ng-repeat="history in orderReturnHistory">
                                                                        <td>{{$index + 1}}</td>
                                                                        <td>
                                                                            {{history.orderDetail.product.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{history.productDetail.size.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{history.productDetail.color.name}}
                                        
                                                                        </td>
                                                                        <td>
                                                                            {{history.quantity}}
                                                                        </td>
                                                                        <td>
                                                                            {{history.action == "DOI" ? "Đổi" : "Trả" }}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <hr>
                                                        <div class="mt-3 mb-3">
                                                            <form name="formUserOrder">
                                                                <textarea class="form-control" rows="3" placeholder="Lý do đổi trả*" ng-model="reasonReturn"
                                                                name="description" ng-required="true" ng-trim="true" minlength="5" maxlength="255" autocomplete="off"
                                                                ></textarea>
                                                                <div class="text-danger" ng-hide="formUserOrder.description.$untouched || formUserOrder.description.$valid">
                                                                    <small class="text-danger" ng-show="formUserOrder.description.$error.required"> Vui lòng nhập lý do đổi trả!</small>
                                                                    <small class="text-danger" ng-show="formUserOrder.description.$error.minlength">Hãy nhập thông tin hợp lệ!</small>
                                                                    <small class="text-danger" ng-show="formUserOrder.description.$error.maxlength">Không được nhập quá 255 ký tự!</small>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <hr>
                                                        <div class="mt-3" ng-if="orderReturn.orderHistories">
                                                            <h5>Lịch sử đổi trả</h5>
                                                            <table class="table table-responsive">  
                                                                <thead>
                                                                    <tr>
                                                                        <th>STT</th>
                                                                        <th>Sản phẩm</th>
                                                                        <th>Size</th>
                                                                        <th>Màu sắc</th>
                                                                        <th>Số lượng</th>
                                                                        <th>Hành động</th>
                                                                        <th>Trạng thái</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr ng-repeat="orderHistory in orderReturn.orderHistories">
                                                                        <td>{{$index + 1}}</td>
                                                                        <td>
                                                                            {{orderHistory.orderDetail.product.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderHistory.productDetail.size.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderHistory.productDetail.color.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderHistory.quantity}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderHistory.action == "DOI" ? "Đổi" : "Trả"}}
                                                                        </td>
                                                                        <td>
                                                                            {{orderHistory.status == "DONE" ? "Hoàn thành" : orderHistory.status == "WAIT" ? "Đang chờ xác nhận" : "Không được xác nhận"}}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <div ng-if="!active">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" ng-click="cancel()">Hủy</button>
                                                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" ng-disabled="orderReturnHistory.length == 0 || formUserOrder.description.$invalid" 
                                                            data-bs-target="#updateReturnOrder"
                                                            >Tạo yêu cầu</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Modal tra hang-->
                                        <div class="modal fade" id="returnProduct" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="btn-close"  aria-label="Close" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#modalReturnOrder"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <input type="number" class="form-control" ng-model="orderReturnWaitQuantityReturn" placeholder="Nhập số lượng">
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#modalReturnOrder">Hủy</button>
                                                        <button type="button" ng-click="returnMultipleProduct()" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal"  data-bs-target="#modalReturnOrder">Trả</button>
                                                        <button type="button" ng-click="returnAllProduct()" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal"  data-bs-target="#modalReturnOrder">Trả tất cả</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- end modal doi tra hang -->

                                        <!-- Modal doi hang-->
                                        <div class="modal fade" id="changeProduct" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-bs-toggle="modal"  data-bs-target="#modalReturnOrder"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <input type="number" class="form-control" ng-model="orderReturnWaitQuantityChange" placeholder="Nhập số lượng">
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bs-toggle="modal"  data-bs-target="#modalReturnOrder">Hủy</button>
                                                        <button type="button" ng-click="changeMultipleProduct()" class="btn btn-primary"  data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#modalReturnOrder">Đổi</button>
                                                        <button type="button" ng-click="changeAllProduct()" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#modalReturnOrder">Đổi tất cả</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- end modal doi hang -->

                                        <!-- Modal xác nhận update product -->
                                        <div class="modal fade" id="updateReturnOrder" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#modalReturnOrder" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        Tạo yêu cầu đổi trả hàng
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#modalReturnOrder">Hủy</button>
                                                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" ng-click="createReturnOrder()">Xác nhận</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        
                </div>
        
            </div>
        </div>
        <div class="tab-pane fade" id="orderReturn" role="tabpanel" aria-labelledby="orderReturn-tab">
            <h5>Lịch sử đổi trả</h5>
        </div>
    </div>
    
</div>